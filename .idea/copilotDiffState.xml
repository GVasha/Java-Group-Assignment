<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/controllers/PatientPageController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/controllers/PatientPageController.java" />
              <option name="originalContent" value="package controllers;&#10;&#10;import appointments.Appointment;&#10;import core.AppState;&#10;import database_management.AppointmentService;&#10;import database_management.PatientService;&#10;import javafx.beans.property.SimpleStringProperty;&#10;import javafx.collections.FXCollections;&#10;import javafx.fxml.FXML;&#10;import javafx.scene.control.Alert;&#10;import javafx.scene.control.Button;&#10;import javafx.scene.control.ButtonType;&#10;import javafx.scene.control.ComboBox;&#10;import javafx.scene.control.DatePicker;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.control.TableColumn;&#10;import javafx.scene.control.TableView;&#10;import javafx.scene.control.TextField;&#10;import javafx.scene.layout.FlowPane;&#10;import javafx.scene.layout.VBox;&#10;import users.Doctor;&#10;&#10;import java.time.LocalDateTime;&#10;import java.time.format.DateTimeFormatter;&#10;import java.util.List;&#10;&#10;import static database_management.AppointmentService.fetchAppointmentById;&#10;&#10;public class PatientPageController extends BaseController {&#10;&#10;    @FXML private Button bookButton;&#10;    @FXML private Button appointmentsButton;&#10;    @FXML private Button profileButton;&#10;&#10;    @FXML private FlowPane appointmentsGrid;&#10;    @FXML private DatePicker startDatePicker;&#10;    @FXML private DatePicker endDatePicker;&#10;    @FXML private TextField doctorIdField;&#10;    @FXML private ComboBox&lt;String&gt; statusCombo;&#10;&#10;    @FXML private TableView&lt;Appointment&gt; appointmentsTable;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; dateColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; timeColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; doctorIdColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; doctorColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; notesColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; statusColumn;&#10;&#10;    private final AppState appState = AppState.getInstance();&#10;&#10;    private final DateTimeFormatter dateFmt = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);&#10;    private final DateTimeFormatter timeFmt = DateTimeFormatter.ofPattern(&quot;HH:mm&quot;);&#10;    private final DateTimeFormatter dateTimeFmt = DateTimeFormatter.ofPattern(&quot;MMM dd, yyyy&quot;);&#10;&#10;    @FXML private Label patientGreetingLabel;&#10;&#10;    public void initialize() {&#10;        if (appState.getUser() != null &amp;&amp; patientGreetingLabel != null) {&#10;            patientGreetingLabel.setText(&quot;Hello, &quot; + appState.getUser().getName());&#10;        }&#10;&#10;        if (statusCombo != null) {&#10;            statusCombo.getItems().setAll(&quot;SCHEDULED&quot;, &quot;COMPLETED&quot;, &quot;CANCELLED&quot;);&#10;            statusCombo.setValue(&quot;SCHEDULED&quot;);&#10;        }&#10;&#10;        setupTableColumns();&#10;        loadAppointments();&#10;    }&#10;&#10;    @FXML&#10;    private void handleBookButton() {&#10;        System.out.println(&quot;Book button clicked!&quot;);&#10;        screenManager.show(&quot;PatientBookingPage.fxml&quot;);&#10;    }&#10;&#10;    @FXML&#10;    private void handleAppointmentsButton() {&#10;        System.out.println(&quot;Appointments button clicked!&quot;);&#10;        // TODO: navigate to appointments page&#10;    }&#10;&#10;    @FXML&#10;    private void handleProfileButton() {&#10;        System.out.println(&quot;Profile button clicked!&quot;);&#10;        // TODO: navigate to patient profile/settings page&#10;    }&#10;&#10;&#10;    private void loadAppointments() {&#10;        try {&#10;            int patientId = appState.getUserId();&#10;            List&lt;Appointment&gt; appointments = PatientService.fetchAppointmentsForPatientFiltered(&#10;                    patientId, null, null, null, null&#10;            );&#10;&#10;            renderAppointments(appointments);&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    private void renderAppointments(List&lt;Appointment&gt; appointments) {&#10;        if (appointmentsGrid != null) {&#10;            appointmentsGrid.getChildren().clear();&#10;            for (Appointment appt : appointments) {&#10;                appointmentsGrid.getChildren().add(createAppointmentCard(appt));&#10;            }&#10;        }&#10;&#10;        if (appointmentsTable != null) {&#10;            appointmentsTable.setItems(FXCollections.observableArrayList(appointments));&#10;        }&#10;    }&#10;&#10;    private VBox createAppointmentCard(Appointment appt) {&#10;        VBox card = new VBox();&#10;        card.setSpacing(12);&#10;        card.setPrefWidth(280);&#10;        card.setStyle(&quot;-fx-background-color: #ffffff; &quot; +&#10;                &quot;-fx-background-radius: 16; &quot; +&#10;                &quot;-fx-padding: 24; &quot; +&#10;                &quot;-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 12, 0, 0, 4); &quot; +&#10;                &quot;-fx-border-color: #e2e8f0; &quot; +&#10;                &quot;-fx-border-width: 1; &quot; +&#10;                &quot;-fx-border-radius: 16;&quot;);&#10;&#10;        // Date label&#10;        Label dateLabel = new Label();&#10;        LocalDateTime dt = appt.getDate();&#10;        if (dt != null) {&#10;            String dateStr = dt.format(dateTimeFmt) + &quot; at &quot; + dt.format(timeFmt);&#10;            dateLabel.setText(dateStr);&#10;        } else {&#10;            dateLabel.setText(&quot;Date: Not set&quot;);&#10;        }&#10;        dateLabel.setStyle(&quot;-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #1e293b;&quot;);&#10;&#10;        // Doctor label&#10;        Label doctorLabel = new Label();&#10;        Doctor doctor = appt.getDoctor();&#10;        if (doctor != null) {&#10;            doctorLabel.setText(&quot;Dr. &quot; + doctor.getName());&#10;        } else {&#10;            doctorLabel.setText(&quot;Doctor: Not assigned&quot;);&#10;        }&#10;        doctorLabel.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #475569;&quot;);&#10;&#10;        // Specialization label&#10;        Label specializationLabel = new Label();&#10;        if (doctor != null) {&#10;            String specialization = doctor.getSpecialization();&#10;            if (specialization != null &amp;&amp; !specialization.isEmpty() &amp;&amp; !specialization.equals(&quot;none&quot;)) {&#10;                specializationLabel.setText(&quot;Specialization: &quot; + specialization);&#10;                specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #64748b;&quot;);&#10;            } else {&#10;                specializationLabel.setText(&quot;Specialization: General&quot;);&#10;                specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;            }&#10;        } else {&#10;            specializationLabel.setText(&quot;Specialization: N/A&quot;);&#10;            specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;        }&#10;&#10;        // Status label with color coding&#10;        Label statusLabel = new Label();&#10;        String status = appt.getStatus();&#10;        if (status != null &amp;&amp; !status.isEmpty()) {&#10;            statusLabel.setText(&quot;Status: &quot; + status);&#10;            String statusColor;&#10;            switch (status.toUpperCase()) {&#10;                case &quot;SCHEDULED&quot;:&#10;                    statusColor = &quot;#3b82f6&quot;; // Blue&#10;                    break;&#10;                case &quot;COMPLETED&quot;:&#10;                    statusColor = &quot;#10b981&quot;; // Green&#10;                    break;&#10;                case &quot;CANCELLED&quot;:&#10;                    statusColor = &quot;#ef4444&quot;; // Red&#10;                    break;&#10;                case &quot;AVAILABLE&quot;:&#10;                    statusColor = &quot;#8b5cf6&quot;; // Purple&#10;                    break;&#10;                default:&#10;                    statusColor = &quot;#64748b&quot;; // Gray&#10;            }&#10;            statusLabel.setStyle(&quot;-fx-font-size: 13px; -fx-font-weight: 600; -fx-text-fill: &quot; + statusColor + &quot;;&quot;);&#10;        } else {&#10;            statusLabel.setText(&quot;Status: Unknown&quot;);&#10;            statusLabel.setStyle(&quot;-fx-font-size: 13px; -fx-font-weight: 600; -fx-text-fill: #64748b;&quot;);&#10;        }&#10;&#10;        // Notes label&#10;        Label notesLabel = new Label();&#10;        String notes = appt.getNotes();&#10;        if (notes != null &amp;&amp; !notes.trim().isEmpty()) {&#10;            notesLabel.setText(&quot;Notes: &quot; + notes);&#10;            notesLabel.setWrapText(true);&#10;            notesLabel.setMaxWidth(232); // Card width minus padding&#10;            notesLabel.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #64748b;&quot;);&#10;        } else {&#10;            notesLabel.setText(&quot;Notes: None&quot;);&#10;            notesLabel.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;        }&#10;&#10;        // Cancel button&#10;        Button cancelButton = new Button(&quot;Cancel Appointment&quot;);&#10;        cancelButton.setStyle(&quot;-fx-background-color: #ef4444; &quot; +&#10;                &quot;-fx-text-fill: white; &quot; +&#10;                &quot;-fx-font-size: 13px; &quot; +&#10;                &quot;-fx-font-weight: 600; &quot; +&#10;                &quot;-fx-padding: 8 16; &quot; +&#10;                &quot;-fx-background-radius: 8; &quot; +&#10;                &quot;-fx-cursor: hand; &quot; +&#10;                &quot;-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 4, 0, 0, 2);&quot;);&#10;        cancelButton.setOnAction(e -&gt; handleCancelAppointment(appt.getId()));&#10;&#10;        card.getChildren().addAll(dateLabel, doctorLabel, specializationLabel, statusLabel, notesLabel, cancelButton);&#10;&#10;        return card;&#10;    }&#10;&#10;    private void handleCancelAppointment(int appointmentId) {&#10;        try {&#10;            Appointment fetchedAppointment = fetchAppointmentById(appointmentId);&#10;            if (fetchedAppointment == null) {&#10;                System.err.println(&quot;Appointment not found: &quot; + appointmentId);&#10;                return;&#10;            }&#10;            fetchedAppointment.setStatus(&quot;CANCELLED&quot;);&#10;            AppointmentService.updateAppointment(fetchedAppointment);&#10;            loadAppointments(); // Reload to reflect the change&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            System.err.println(&quot;Failed to cancel appointment: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void setupTableColumns() {&#10;        if (appointmentsTable == null) {&#10;            return;&#10;        }&#10;&#10;        appointmentsTable.setPlaceholder(new Label(&quot;No appointments yet.&quot;));&#10;&#10;        if (dateColumn != null) {&#10;            dateColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(formatDate(cell.getValue().getDate())));&#10;        }&#10;        if (timeColumn != null) {&#10;            timeColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(formatTime(cell.getValue().getDate())));&#10;        }&#10;        if (doctorIdColumn != null) {&#10;            doctorIdColumn.setCellValueFactory(cell -&gt; {&#10;                Doctor doc = cell.getValue().getDoctor();&#10;                return new SimpleStringProperty(doc != null ? String.valueOf(doc.getId()) : &quot;-&quot;);&#10;            });&#10;        }&#10;        if (doctorColumn != null) {&#10;            doctorColumn.setCellValueFactory(cell -&gt; {&#10;                Doctor doc = cell.getValue().getDoctor();&#10;                return new SimpleStringProperty(doc != null ? doc.getName() : &quot;Unassigned&quot;);&#10;            });&#10;        }&#10;        if (notesColumn != null) {&#10;            notesColumn.setCellValueFactory(cell -&gt; {&#10;                String notes = cell.getValue().getNotes();&#10;                return new SimpleStringProperty(notes != null &amp;&amp; !notes.trim().isEmpty() ? notes : &quot;-&quot;);&#10;            });&#10;        }&#10;        if (statusColumn != null) {&#10;            statusColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(&#10;                    cell.getValue().getStatus() != null ? cell.getValue().getStatus() : &quot;-&quot;&#10;            ));&#10;        }&#10;    }&#10;&#10;    private String formatDate(LocalDateTime dt) {&#10;        return dt != null ? dt.format(dateFmt) : &quot;-&quot;;&#10;    }&#10;&#10;    private String formatTime(LocalDateTime dt) {&#10;        return dt != null ? dt.format(timeFmt) : &quot;-&quot;;&#10;    }&#10;&#10;    @FXML&#10;    private void handleFilter() {&#10;        try {&#10;            LocalDateTime start = null;&#10;            LocalDateTime end = null;&#10;            Integer doctorId = null;&#10;            String status = null;&#10;&#10;            if (startDatePicker != null &amp;&amp; startDatePicker.getValue() != null) {&#10;                start = startDatePicker.getValue().atStartOfDay();&#10;            }&#10;            if (endDatePicker != null &amp;&amp; endDatePicker.getValue() != null) {&#10;                end = endDatePicker.getValue().atTime(23, 59, 59);&#10;            }&#10;            if (doctorIdField != null &amp;&amp; !doctorIdField.getText().trim().isEmpty()) {&#10;                doctorId = Integer.parseInt(doctorIdField.getText().trim());&#10;            }&#10;&#10;            String selectedStatus = statusCombo != null ? statusCombo.getValue() : null;&#10;            if (selectedStatus != null &amp;&amp; !selectedStatus.trim().isEmpty()) {&#10;                status = selectedStatus.trim();&#10;            }&#10;&#10;            int patientId = appState.getUserId();&#10;            List&lt;Appointment&gt; filtered = PatientService.fetchAppointmentsForPatientFiltered(patientId, start, end, doctorId, status);&#10;&#10;            renderAppointments(filtered);&#10;&#10;        } catch (NumberFormatException nfe) {&#10;            System.out.println(&quot;Invalid doctor ID entered.&quot;);&#10;            Alert a = new Alert(Alert.AlertType.WARNING, &quot;Invalid doctor ID. Please enter a number.&quot;, ButtonType.OK);&#10;            a.show();&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            Alert a = new Alert(Alert.AlertType.ERROR, &quot;Failed to fetch appointments.&quot;, ButtonType.OK);&#10;            a.show();&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void handleReset() {&#10;        loadAppointments();&#10;&#10;        if (startDatePicker != null) startDatePicker.setValue(null);&#10;        if (endDatePicker != null) endDatePicker.setValue(null);&#10;        if (doctorIdField != null) doctorIdField.clear();&#10;        if (statusCombo != null) statusCombo.setValue(&quot;SCHEDULED&quot;);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package controllers;&#10;&#10;import appointments.Appointment;&#10;import core.AppState;&#10;import database_management.AppointmentService;&#10;import database_management.PatientService;&#10;import javafx.beans.property.SimpleStringProperty;&#10;import javafx.collections.FXCollections;&#10;import javafx.fxml.FXML;&#10;import javafx.scene.control.Alert;&#10;import javafx.scene.control.Button;&#10;import javafx.scene.control.ButtonType;&#10;import javafx.scene.control.ComboBox;&#10;import javafx.scene.control.DatePicker;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.control.TableColumn;&#10;import javafx.scene.control.TableView;&#10;import javafx.scene.control.TextField;&#10;import javafx.scene.layout.FlowPane;&#10;import javafx.scene.layout.VBox;&#10;import users.Doctor;&#10;&#10;import java.time.LocalDateTime;&#10;import java.time.format.DateTimeFormatter;&#10;import java.util.List;&#10;&#10;import static database_management.AppointmentService.fetchAppointmentById;&#10;&#10;public class PatientPageController extends BaseController {&#10;&#10;    @FXML private Button bookButton;&#10;    @FXML private Button appointmentsButton;&#10;    @FXML private Button profileButton;&#10;&#10;    @FXML private FlowPane appointmentsGrid;&#10;    @FXML private DatePicker startDatePicker;&#10;    @FXML private DatePicker endDatePicker;&#10;    @FXML private TextField doctorIdField;&#10;    @FXML private ComboBox&lt;String&gt; statusCombo;&#10;&#10;    @FXML private TableView&lt;Appointment&gt; appointmentsTable;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; dateColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; timeColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; doctorIdColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; doctorColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; notesColumn;&#10;    @FXML private TableColumn&lt;Appointment, String&gt; statusColumn;&#10;&#10;    private final AppState appState = AppState.getInstance();&#10;&#10;    private final DateTimeFormatter dateFmt = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);&#10;    private final DateTimeFormatter timeFmt = DateTimeFormatter.ofPattern(&quot;HH:mm&quot;);&#10;    private final DateTimeFormatter dateTimeFmt = DateTimeFormatter.ofPattern(&quot;MMM dd, yyyy&quot;);&#10;&#10;    @FXML private Label patientGreetingLabel;&#10;&#10;    public void initialize() {&#10;        if (appState.getUser() != null &amp;&amp; patientGreetingLabel != null) {&#10;            patientGreetingLabel.setText(&quot;Hello, &quot; + appState.getUser().getName());&#10;        }&#10;&#10;        if (statusCombo != null) {&#10;            statusCombo.getItems().setAll(&quot;SCHEDULED&quot;, &quot;COMPLETED&quot;, &quot;CANCELLED&quot;);&#10;            statusCombo.setValue(&quot;SCHEDULED&quot;);&#10;        }&#10;&#10;        setupTableColumns();&#10;        loadAppointments();&#10;    }&#10;&#10;    @FXML&#10;    private void handleBookButton() {&#10;        System.out.println(&quot;Book button clicked!&quot;);&#10;        screenManager.show(&quot;PatientBookingPage.fxml&quot;);&#10;    }&#10;&#10;    @FXML&#10;    private void handleAppointmentsButton() {&#10;        System.out.println(&quot;Appointments button clicked!&quot;);&#10;        // TODO: navigate to appointments page&#10;    }&#10;&#10;    @FXML&#10;    private void handleProfileButton() {&#10;        System.out.println(&quot;Profile button clicked!&quot;);&#10;        // TODO: navigate to patient profile/settings page&#10;    }&#10;&#10;&#10;    private void loadAppointments() {&#10;        try {&#10;            int patientId = appState.getUserId();&#10;            List&lt;Appointment&gt; appointments = PatientService.fetchAppointmentsForPatientFiltered(&#10;                    patientId, null, null, null, null&#10;            );&#10;&#10;            renderAppointments(appointments);&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    private void renderAppointments(List&lt;Appointment&gt; appointments) {&#10;        if (appointmentsGrid != null) {&#10;            appointmentsGrid.getChildren().clear();&#10;            for (Appointment appt : appointments) {&#10;                appointmentsGrid.getChildren().add(createAppointmentCard(appt));&#10;            }&#10;        }&#10;&#10;        if (appointmentsTable != null) {&#10;            appointmentsTable.setItems(FXCollections.observableArrayList(appointments));&#10;        }&#10;    }&#10;&#10;    private VBox createAppointmentCard(Appointment appt) {&#10;        VBox card = new VBox();&#10;        card.setSpacing(12);&#10;        card.setPrefWidth(280);&#10;        card.setStyle(&quot;-fx-background-color: #ffffff; &quot; +&#10;                &quot;-fx-background-radius: 16; &quot; +&#10;                &quot;-fx-padding: 24; &quot; +&#10;                &quot;-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 12, 0, 0, 4); &quot; +&#10;                &quot;-fx-border-color: #e2e8f0; &quot; +&#10;                &quot;-fx-border-width: 1; &quot; +&#10;                &quot;-fx-border-radius: 16;&quot;);&#10;&#10;        // Date label&#10;        Label dateLabel = new Label();&#10;        LocalDateTime dt = appt.getDate();&#10;        if (dt != null) {&#10;            String dateStr = dt.format(dateTimeFmt) + &quot; at &quot; + dt.format(timeFmt);&#10;            dateLabel.setText(dateStr);&#10;        } else {&#10;            dateLabel.setText(&quot;Date: Not set&quot;);&#10;        }&#10;        dateLabel.setStyle(&quot;-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #1e293b;&quot;);&#10;&#10;        // Doctor label&#10;        Label doctorLabel = new Label();&#10;        Doctor doctor = appt.getDoctor();&#10;        if (doctor != null) {&#10;            doctorLabel.setText(&quot;Dr. &quot; + doctor.getName());&#10;        } else {&#10;            doctorLabel.setText(&quot;Doctor: Not assigned&quot;);&#10;        }&#10;        doctorLabel.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #475569;&quot;);&#10;&#10;        // Specialization label&#10;        Label specializationLabel = new Label();&#10;        if (doctor != null) {&#10;            String specialization = doctor.getSpecialization();&#10;            if (specialization != null &amp;&amp; !specialization.isEmpty() &amp;&amp; !specialization.equals(&quot;none&quot;)) {&#10;                specializationLabel.setText(&quot;Specialization: &quot; + specialization);&#10;                specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #64748b;&quot;);&#10;            } else {&#10;                specializationLabel.setText(&quot;Specialization: General&quot;);&#10;                specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;            }&#10;        } else {&#10;            specializationLabel.setText(&quot;Specialization: N/A&quot;);&#10;            specializationLabel.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;        }&#10;&#10;        // Status label with color coding&#10;        Label statusLabel = new Label();&#10;        String status = appt.getStatus();&#10;        if (status != null &amp;&amp; !status.isEmpty()) {&#10;            statusLabel.setText(&quot;Status: &quot; + status);&#10;            String statusColor;&#10;            switch (status.toUpperCase()) {&#10;                case &quot;SCHEDULED&quot;:&#10;                    statusColor = &quot;#3b82f6&quot;; // Blue&#10;                    break;&#10;                case &quot;COMPLETED&quot;:&#10;                    statusColor = &quot;#10b981&quot;; // Green&#10;                    break;&#10;                case &quot;CANCELLED&quot;:&#10;                    statusColor = &quot;#ef4444&quot;; // Red&#10;                    break;&#10;                case &quot;AVAILABLE&quot;:&#10;                    statusColor = &quot;#8b5cf6&quot;; // Purple&#10;                    break;&#10;                default:&#10;                    statusColor = &quot;#64748b&quot;; // Gray&#10;            }&#10;            statusLabel.setStyle(&quot;-fx-font-size: 13px; -fx-font-weight: 600; -fx-text-fill: &quot; + statusColor + &quot;;&quot;);&#10;        } else {&#10;            statusLabel.setText(&quot;Status: Unknown&quot;);&#10;            statusLabel.setStyle(&quot;-fx-font-size: 13px; -fx-font-weight: 600; -fx-text-fill: #64748b;&quot;);&#10;        }&#10;&#10;        // Notes label&#10;        Label notesLabel = new Label();&#10;        String notes = appt.getNotes();&#10;        if (notes != null &amp;&amp; !notes.trim().isEmpty()) {&#10;            notesLabel.setText(&quot;Notes: &quot; + notes);&#10;            notesLabel.setWrapText(true);&#10;            notesLabel.setMaxWidth(232); // Card width minus padding&#10;            notesLabel.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #64748b;&quot;);&#10;        } else {&#10;            notesLabel.setText(&quot;Notes: None&quot;);&#10;            notesLabel.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #94a3b8; -fx-font-style: italic;&quot;);&#10;        }&#10;&#10;        // Cancel button&#10;        Button cancelButton = new Button(&quot;Cancel Appointment&quot;);&#10;        cancelButton.setStyle(&quot;-fx-background-color: #ef4444; &quot; +&#10;                &quot;-fx-text-fill: white; &quot; +&#10;                &quot;-fx-font-size: 13px; &quot; +&#10;                &quot;-fx-font-weight: 600; &quot; +&#10;                &quot;-fx-padding: 8 16; &quot; +&#10;                &quot;-fx-background-radius: 8; &quot; +&#10;                &quot;-fx-cursor: hand; &quot; +&#10;                &quot;-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 4, 0, 0, 2);&quot;);&#10;        cancelButton.setOnAction(e -&gt; handleCancelAppointment(appt.getId()));&#10;&#10;        card.getChildren().addAll(dateLabel, doctorLabel, specializationLabel, statusLabel, notesLabel, cancelButton);&#10;&#10;        return card;&#10;    }&#10;&#10;    private void handleCancelAppointment(int appointmentId) {&#10;        try {&#10;            Appointment fetchedAppointment = fetchAppointmentById(appointmentId);&#10;            if (fetchedAppointment == null) {&#10;                System.err.println(&quot;Appointment not found: &quot; + appointmentId);&#10;                return;&#10;            }&#10;            fetchedAppointment.setStatus(&quot;CANCELLED&quot;);&#10;            AppointmentService.updateAppointment(fetchedAppointment);&#10;            loadAppointments(); // Reload to reflect the change&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            System.err.println(&quot;Failed to cancel appointment: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void setupTableColumns() {&#10;        if (appointmentsTable == null) {&#10;            return;&#10;        }&#10;&#10;        appointmentsTable.setPlaceholder(new Label(&quot;No appointments yet.&quot;));&#10;&#10;        if (dateColumn != null) {&#10;            dateColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(formatDate(cell.getValue().getDate())));&#10;        }&#10;        if (timeColumn != null) {&#10;            timeColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(formatTime(cell.getValue().getDate())));&#10;        }&#10;        if (doctorIdColumn != null) {&#10;            doctorIdColumn.setCellValueFactory(cell -&gt; {&#10;                Doctor doc = cell.getValue().getDoctor();&#10;                return new SimpleStringProperty(doc != null ? String.valueOf(doc.getId()) : &quot;-&quot;);&#10;            });&#10;        }&#10;        if (doctorColumn != null) {&#10;            doctorColumn.setCellValueFactory(cell -&gt; {&#10;                Doctor doc = cell.getValue().getDoctor();&#10;                return new SimpleStringProperty(doc != null ? doc.getName() : &quot;Unassigned&quot;);&#10;            });&#10;        }&#10;        if (notesColumn != null) {&#10;            notesColumn.setCellValueFactory(cell -&gt; {&#10;                String notes = cell.getValue().getNotes();&#10;                return new SimpleStringProperty(notes != null &amp;&amp; !notes.trim().isEmpty() ? notes : &quot;-&quot;);&#10;            });&#10;        }&#10;        if (statusColumn != null) {&#10;            statusColumn.setCellValueFactory(cell -&gt; new SimpleStringProperty(&#10;                    cell.getValue().getStatus() != null ? cell.getValue().getStatus() : &quot;-&quot;&#10;            ));&#10;        }&#10;    }&#10;&#10;    private String formatDate(LocalDateTime dt) {&#10;        return dt != null ? dt.format(dateFmt) : &quot;-&quot;;&#10;    }&#10;&#10;    private String formatTime(LocalDateTime dt) {&#10;        return dt != null ? dt.format(timeFmt) : &quot;-&quot;;&#10;    }&#10;&#10;    @FXML&#10;    private void handleFilter() {&#10;        try {&#10;            LocalDateTime start = null;&#10;            LocalDateTime end = null;&#10;            Integer doctorId = null;&#10;            String status = null;&#10;&#10;            if (startDatePicker != null &amp;&amp; startDatePicker.getValue() != null) {&#10;                start = startDatePicker.getValue().atStartOfDay();&#10;            }&#10;            if (endDatePicker != null &amp;&amp; endDatePicker.getValue() != null) {&#10;                end = endDatePicker.getValue().atTime(23, 59, 59);&#10;            }&#10;            if (doctorIdField != null &amp;&amp; !doctorIdField.getText().trim().isEmpty()) {&#10;                doctorId = Integer.parseInt(doctorIdField.getText().trim());&#10;            }&#10;&#10;            String selectedStatus = statusCombo != null ? statusCombo.getValue() : null;&#10;            if (selectedStatus != null &amp;&amp; !selectedStatus.trim().isEmpty()) {&#10;                status = selectedStatus.trim();&#10;            }&#10;&#10;            int patientId = appState.getUserId();&#10;            List&lt;Appointment&gt; filtered = PatientService.fetchAppointmentsForPatientFiltered(patientId, start, end, doctorId, status);&#10;&#10;            renderAppointments(filtered);&#10;&#10;        } catch (NumberFormatException nfe) {&#10;            System.out.println(&quot;Invalid doctor ID entered.&quot;);&#10;            Alert a = new Alert(Alert.AlertType.WARNING, &quot;Invalid doctor ID. Please enter a number.&quot;, ButtonType.OK);&#10;            a.show();&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            Alert a = new Alert(Alert.AlertType.ERROR, &quot;Failed to fetch appointments.&quot;, ButtonType.OK);&#10;            a.show();&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void handleReset() {&#10;        loadAppointments();&#10;&#10;        if (startDatePicker != null) startDatePicker.setValue(null);&#10;        if (endDatePicker != null) endDatePicker.setValue(null);&#10;        if (doctorIdField != null) doctorIdField.clear();&#10;        if (statusCombo != null) statusCombo.setValue(&quot;SCHEDULED&quot;);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>